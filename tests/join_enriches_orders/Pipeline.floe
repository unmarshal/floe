schema User {
    id: String,
    name: String,
}

schema Order {
    order_id: String,
    user_id: String,
}

schema EnrichedOrder {
    order_id: String,
    name: String,
}

let users = read "users.parquet" as User

let enrich : Order -> EnrichedOrder =
    join users on .user_id == .id
    >> map { order_id: .order_id, name: .name }

main = do
    data <- read "orders.parquet" as Order
    result <- data |> enrich
    sink "output.parquet" result

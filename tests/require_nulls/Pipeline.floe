-- Test require operation filters nulls and refines Maybe T -> T

schema UserInput {
    id: String,
    name: Maybe String,
    age: Maybe Int64,
}

schema UserComplete {
    id: String,
    name: String,
    age: Int64,
}

let filterComplete : UserInput -> UserComplete =
    require [name, age] >>
    map {
        id: .id,
        name: .name,
        age: .age
    }

main = do
    data <- read "input.parquet" as UserInput
    result <- data |> filterComplete
    sink "output.parquet" result

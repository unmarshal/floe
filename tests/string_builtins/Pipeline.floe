-- Test string builtin functions

schema RawUrl {
    id: String,
    url: String,
    name: String,
}

schema CleanUrl {
    id: String,
    url: String,
    name: String,
    name_upper: String,
    name_len: Int64,
}

let normalizeUrl : String -> String = trim >> toLowercase >> stripPrefix "https://"

let cleanUrls : RawUrl -> CleanUrl =
    transform [url] normalizeUrl >>
    map {
        id: .id,
        url: .url,
        name: .name,
        name_upper: toUppercase .name,
        name_len: lenChars .name
    }

main = do
    data <- read "input.parquet" as RawUrl
    result <- data |> cleanUrls
    sink "output.parquet" result

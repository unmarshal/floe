-- Test Decimal type for currency calculations

schema Invoice {
    id: String,
    amount: Decimal(10, 2),
    tax_rate: Decimal(5, 4),
}

schema InvoiceWithTax {
    id: String,
    amount: Decimal(10, 2),
    tax_rate: Decimal(5, 4),
    tax_amount: Decimal(10, 4),
    total: Decimal(10, 4),
    doubled: Decimal(10, 2),
}

let calculateTax : Invoice -> InvoiceWithTax =
    map {
        id: .id,
        amount: .amount,
        tax_rate: .tax_rate,
        tax_amount: .amount * .tax_rate,
        total: .amount + .amount * .tax_rate,
        doubled: .amount * 2
    }

main = do
    data <- read "input.parquet" as Invoice
    result <- data |> calculateTax
    sink "output.parquet" result
